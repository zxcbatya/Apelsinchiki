# Полная документация: Система оптимизации цен на поездки

## Содержание
1. [Обзор проекта](#обзор-проекта)
2. [Постановка задачи](#постановка-задачи)
3. [Описание набора данных](#описание-набора-данных)
4. [Методология](#методология)
5. [Детали реализации](#детали-реализации)
6. [Архитектура модели](#архитектура-модели)
7. [Результаты и оценка](#результаты-и-оценка)
8. [Инструкции по использованию](#инструкции-по-использованию)
9. [Структура файлов](#структура-файлов)
10. [Будущие улучшения](#будущие-улучшения)

## Обзор проекта

Этот проект реализует решение машинного обучения для оптимизации цен на поездки в платформе райд-шеринга. Система прогнозирует вероятность того, что пассажир примет предложение водителя по цене, и использует это прогнозирование для определения оптимальных стратегий ценообразования, которые максимизируют ожидаемый доход.

## Постановка задачи

Основная задача заключается в прогнозировании P(is_done=1|x,price_bid_local), где:
- `is_done` - бинарная переменная, указывающая, был ли заказ выполнен (1) или отменен (0)
- `x` представляет собой различные характеристики заказа на поездку
- `price_bid_local` - предложенная водителем цена

Бизнес-целью является нахождение оптимальной цены, которая максимизирует ожидаемый доход: цена × P(is_done=1|x,price)

## Описание набора данных

Набор данных содержит информацию о более чем 50 000 заказах на поездки со следующими ключевыми характеристиками:

### Числовые признаки
- `distance_in_meters`: Расстояние поездки в метрах
- `duration_in_seconds`: Ориентировочная продолжительность поездки в секундах
- `pickup_in_meters`: Расстояние подачи в метрах
- `pickup_in_seconds`: Ориентировочное время подачи в секундах
- `price_start_local`: Начальная цена ожидания пассажира
- `price_bid_local`: Предложенная водителем цена
- `driver_rating`: Рейтинг водителя (шкала 0-5)

### Категориальные признаки
- `carmodel`: Модель автомобиля (например, Logan, Camry)
- `carname`: Марка автомобиля (например, Renault, Toyota)
- `platform`: Мобильная платформа (android, ios)

### Целевая переменная
- `is_done`: Результат заказа (done/cancel)

## Методология

### Предобработка данных
1. **Обработка пропущенных значений**: Заполнение пропущенных рейтингов водителей медианными значениями
2. **Создание признаков**: Создание производных признаков для отражения ценовых взаимосвязей
3. **Кодирование**: Преобразование категориальных переменных в числовые с помощью label encoding
4. **Масштабирование**: Стандартизация числовых признаков для обучения нейронной сети

### Создание признаков
Производные признаки включают:
- Процент увеличения цены: (price_bid_local - price_start_local) / price_start_local
- Абсолютная разница в цене: price_bid_local - price_start_local
- Цена за километр: price_bid_local / (distance_in_meters / 1000)
- Цена за минуту: price_bid_local / (duration_in_seconds / 60)
- Расстояние в километрах и продолжительность в минутах
- Расстояние подачи в километрах и время подачи в минутах

### Разработка модели
1. **Архитектура**: Нейронная сеть с 3 скрытыми слоями (128, 64, 32 нейрона)
2. **Регуляризация**: Слои Dropout для предотвращения переобучения
3. **Обучение**: Бинарная кросс-энтропия потерь с оптимизатором Adam
4. **Валидация**: Разделение 80/20 train/test с 20% валидации во время обучения

### Оптимизация цен
1. **Генерация кандидатов**: Определение диапазона возможных цен для заказа
2. **Прогнозирование вероятности**: Использование обученной модели для прогнозирования принятия для каждой цены
3. **Расчет дохода**: Расчет ожидаемого дохода = цена × вероятность
4. **Оптимизация**: Выбор цены, которая максимизирует ожидаемый доход

## Детали реализации

### Архитектура нейронной сети
```
Входной слой (15 признаков)
├── Плотный слой 1 (128 нейронов, ReLU, Dropout 0.3)
├── Плотный слой 2 (64 нейрона, ReLU, Dropout 0.3)
├── Плотный слой 3 (32 нейрона, ReLU, Dropout 0.2)
└── Выходной слой (1 нейрон, Sigmoid)
```

### Процесс обучения
- **Эпохи**: 50
- **Размер батча**: 32
- **Оптимизатор**: Adam (скорость обучения = 0.001)
- **Функция потерь**: Бинарная кросс-энтропия
- **Метрики**: Точность

### Конвейер данных
1. Загрузка данных CSV
2. Предобработка признаков
3. Кодирование категориальных переменных
4. Масштабирование числовых признаков
5. Разделение на обучающую/тестовую выборки
6. Обучение модели
7. Оценка производительности
8. Сохранение обученной модели

## Архитектура модели

### Входные признаки (всего 15)
1. `distance_in_meters`
2. `duration_in_seconds`
3. `driver_rating`
4. `pickup_in_meters`
5. `pickup_in_seconds`
6. `price_start_local`
7. `price_bid_local`
8. `price_increase_percent`
9. `price_abs_diff`
10. `price_per_km`
11. `price_per_minute`
12. `distance_km`
13. `duration_minutes`
14. `pickup_distance_km`
15. `pickup_duration_minutes`
16. Закодированные категориальные признаки (carmodel, carname, platform)

### Скрытые слои
1. **Слой 1**: 128 нейронов, активация ReLU, 0.3 dropout
2. **Слой 2**: 64 нейрона, активация ReLU, 0.3 dropout
3. **Слой 3**: 32 нейрона, активация ReLU, 0.2 dropout

### Выходной слой
- 1 нейрон с сигмоидальной активацией для вывода вероятности

### Регуляризация
- Слои Dropout предотвращают переобучение
- Стандартное масштабирование числовых признаков
- Правильные разделения train/validation/test

## Результаты и оценка

### Метрики производительности
- **Точность**: Процент правильно классифицированных заказов
- **ROC AUC**: Площадь под ROC-кривой для прогнозов вероятностей
- **Точность/Полнота**: Детальная производительность классификации
- **Матрица ошибок**: Истинные/ложные положительные и отрицательные

### Бизнес-метрики
- **Ожидаемый доход**: цена × P(принятия)
- **Оптимальное ценообразование**: Цена, которая максимизирует ожидаемый доход
- **Улучшение дохода**: Сравнение с базовым ценообразованием

### Анализ модели
- **Важность признаков**: Какие признаки больше всего влияют на прогнозы
- **Калибровка**: Насколько хорошо прогнозируемые вероятности соответствуют фактическим результатам
- **Распределение вероятностей**: Распределение прогнозов для разных результатов

## Инструкции по использованию

### Быстрый старт
1. Установите зависимости: `pip install -r requirements.txt`
2. Запустите автоматизированный анализ: `run_analysis.bat` (Windows)
3. Просмотрите результаты в сгенерированных выходных файлах

### Ручное выполнение
1. **Исследование данных**: `python data_exploration.py`
2. **Визуализация данных**: `python visualize_data.py`
3. **Обучение модели**: `python model.py`
4. **Оценка модели**: `python model_evaluation.py`
5. **Новые прогнозы**: `python predict_new_orders.py`
6. **Интерактивный анализ**: Откройте `pricing_model.ipynb` в Jupyter

### Необходимые зависимости
- Python 3.6+
- pandas >= 1.0
- numpy >= 1.18
- scikit-learn >= 0.22
- tensorflow >= 2.0
- matplotlib >= 3.1
- seaborn >= 0.10
- jupyter >= 1.0

## Структура файлов

```
project/
├── train.csv                 # Обучающий набор данных
├── model.py                  # Основная реализация нейронной сети
├── data_exploration.py       # Начальный анализ данных
├── visualize_data.py         # Скрипты визуализации данных
├── predict_new_orders.py     # Демонстрация вывода модели
├── model_evaluation.py       # Комплексная оценка модели
├── pricing_model.ipynb       # Интерактивный Jupyter notebook
├── requirements.txt          # Зависимости Python
├── README.md                 # Обзор проекта
├── project_summary.md        # Резюме на высоком уровне
├── file_summary.md           # Описания файлов
├── model_architecture.md     # Детальная архитектура
├── complete_documentation.md # Этот файл
├── run_analysis.bat          # Скрипт автоматического выполнения
├── pricing_model.h5          # Сохраненная обученная модель
├── training_history.png      # Кривые обучения
├── confusion_matrix.png      # Визуализация матрицы ошибок
├── feature_importance.png    # Диаграмма важности признаков
├── calibration_plot.png      # Калибровка модели
├── probability_distribution.png # Распределение прогнозов
├── data_analysis.png         # Графики распределения данных
└── feature_correlations.png  # Анализ корреляции признаков
```

## Будущие улучшения

### Улучшения модели
1. **Архитектура**: Эксперименты с более глубокими/широкими сетями
2. **Регуляризация**: Добавить L1/L2 регуляризацию, нормализацию батча
3. **Ансамблевые методы**: Объединить несколько моделей для лучшей производительности
4. **Продвинутые техники**: Попробовать XGBoost, Random Forest или другие алгоритмы

### Создание признаков
1. **Временные признаки**: Час суток, день недели, сезонность
2. **Географические признаки**: Если бы были доступны данные о местоположении
3. **Поведение пользователя**: Исторические паттерны бронирования, предпочтения
4. **Производительность водителя**: Исторические уровни принятия, тренды рейтингов

### Рекомендации по развертыванию
1. **Разработка API**: REST API для прогнозов в реальном времени
2. **Контейнеризация**: Развертывание Docker для масштабируемости
3. **Мониторинг**: Отслеживание производительности модели и обнаружение дрейфа
4. **A/B тестирование**: Проверка улучшений с помощью реальных экспериментов

### Бизнес-оптимизация
1. **Многокритериальная оптимизация**: Баланс дохода с удовлетворенностью водителя/пассажира
2. **Динамическое ценообразование**: Корректировки цен в реальном времени на основе спроса
3. **Сегментация**: Разные стратегии для разных сегментов пользователей
4. **Анализ рынка**: Включение данных о ценах конкурентов

## Заключение

Этот проект успешно демонстрирует, как машинное обучение может быть применено для решения реальных бизнес-задач в индустрии райд-шеринга. Модель нейронной сети эффективно прогнозирует вероятности принятия заказов, а алгоритм оптимизации цен предоставляет практические рекомендации для максимизации дохода.

Модульная реализация позволяет легко экспериментировать и расширять, а комплексная документация обеспечивает поддерживаемость и воспроизводимость. Решение балансирует техническую сложность с практической применимостью, что делает его подходящим как для исследований, так и для производственных сред.